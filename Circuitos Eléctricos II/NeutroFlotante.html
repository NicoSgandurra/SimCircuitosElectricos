<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conceptos de Electrotecnia - Neutro Flotante</title>
    <style>
        :root {
            --bg-color: #f0fdf4;
            --card-bg: #ffffff;
            --text-color: #2e4a4a;
            --text-light: #6a9c9c;
            --border-color: #d2f0e0;
            --primary-color: #5ab17c;
            --primary-hover: #4a9e6b;
            --danger-color: #e76f51;
            --danger-hover: #d05c43;
            --code-bg: #e0f2f7;
            --output-bg: #e0f2f7;
            --shadow: 0 4px 12px rgba(0,0,0,0.05);
            --shadow-hover: 0 6px 16px rgba(0,0,0,0.1);
            --color-bg-dark: #12121e;
            --color-bg-light: #1e1e2f;
            --color-card: #2a2a4e;
            --color-primary: #4a4af5;
            --color-accent: #7aa2f7;
            --color-text: #e0e0ff;
            --color-text-muted: #a0a0c0;
            --color-danger: #f77272;
            --color-success: #73daca;
            --color-warning: #ffc777;
        }

        body.dark-mode {
            --bg-color: #1a1523;
            --card-bg: #28203d;
            --text-color: #e6e0f0;
            --text-light: #afa2c3;
            --border-color: #43386b;
            --primary-color: #a78bfa;
            --primary-hover: #9175d6;
            --danger-color: #ef778a;
            --danger-hover: #d56073;
            --code-bg: #3d305e;
            --output-bg: #3d305e;
            --shadow: 0 4px 12px rgba(0,0,0,0.2);
            --shadow-hover: 0 6px 16px rgba(0,0,0,0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1500px;
            margin: 20px auto;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: var(--card-bg);
            border-bottom: 2px solid var(--primary-color);
        }

        header h1 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .content-section {
            padding: 10px 30px 30px;
        }

        h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        h3 {
            color: var(--text-color);
            margin-top: 25px;
            margin-bottom: 10px;
        }

        .content-section > h3:first-child {
            margin-top: 0;
        }

        p, li {
            font-size: 1.05em;
            margin-bottom: 15px;
            color: var(--text-light);
        }

        ul {
            padding-left: 25px;
            list-style-type: 'âš¡ ';
        }

        i { font-style: italic; }
        sub { font-size: 0.75em; vertical-align: sub; }
        sup { font-size: 0.75em; vertical-align: super; }

        .interactive-diagram {
            background-color: var(--bg-color);
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid var(--border-color);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 15px;
            flex-wrap: wrap;
        }
        
        .controls label {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .controls span {
            color: var(--text-color);
            font-weight: bold;
            min-width: 50px;
            display: inline-block;
            text-align: left;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 15px 0;
        }
        
        .load-control {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
        }
        .load-control h4 {
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.1em;
        }
        .load-control-r h4 { color: var(--danger-color); }
        .load-control-t h4 { color: var(--primary-color); }
        .load-control-s h4 { color: var(--color-success); }
        
        .slider-group {
            margin-bottom: 10px;
        }
        .slider-group label {
            display: block;
            font-size: 0.9em;
            color: var(--text-light);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input { display: none; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--color-success);
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--danger-color);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            background: var(--bg-color);
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
            margin-top: 5px;
        }
        input[type="range"]:hover { opacity: 1; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            cursor: pointer;
            border-radius: 50%;
        }
        
        .info-box {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .info-box div {
            text-align: center;
            margin: 5px 10px;
        }
        .info-box span {
            display: block;
            font-size: 0.9em;
            color: var(--text-light);
        }
        .info-box strong {
            font-size: 1.3em;
            color: var(--text-color);
            transition: color 0.3s ease;
        }
        
        #star-diagram {
            background-color: var(--code-bg);
        }

        #star-diagram text {
            font-family: "Segoe UI", sans-serif;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.5s ease;
            pointer-events: none;
        }
        #neutral-point-N {
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        #line-R, #line-T, #line-S {
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        #darkModeToggle {
            background-color: transparent;
            color: var(--text-color);
            font-size: 24px;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            padding: 0;
            cursor: pointer;
        }
        #darkModeToggle:hover {
            background-color: var(--code-bg);
            transform: translateY(-2px) rotate(15deg);
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>ConexiÃ³n Estrella sin Neutro (Neutro Flotante)</h1>
            <button id="darkModeToggle">ðŸŒ™</button>
        </header>

        <section class="content-section active" id="content-tema1">
            <h3>ExplicaciÃ³n Conceptual</h3>
            <p>En un sistema trifÃ¡sico normal en <strong>Estrella (Y)</strong>, el cable <strong>Neutro (N)</strong> actÃºa como un "ancla". Conecta el punto central de las cargas al punto central del generador.</p>
            <ul>
                <li><strong>FunciÃ³n del Neutro:</strong> Garantiza que, aunque las cargas en cada fase sean distintas (sistema desequilibrado), la tensiÃ³n en cada carga se mantenga estable (ej. 220V). Sirve como camino de retorno para la corriente de desequilibrio.</li>
            </ul>

            <h3>Â¿QuÃ© es el "Neutro Flotante"?</h3>
            <p>Ocurre cuando conectamos las cargas en estrella <strong>PERO no conectamos el cable neutro</strong>. El punto central de la carga (N) queda "flotando".</p>
            <ul>
                <li><strong>Sistema Equilibrado:</strong> Si las 3 cargas son idÃ©nticas (<i>Z</i><sub>R</sub> = <i>Z</i><sub>T</sub> = <i>Z</i><sub>S</sub>), no hay problema. La suma de corrientes es cero y el punto N se mantiene naturalmente en su lugar.</li>
                <li><strong>Sistema Desequilibrado:</strong> Â¡AquÃ­ estÃ¡ el peligro! Como no hay cable neutro, la suma de corrientes (<i>I</i><sub>R</sub> + <i>I</i><sub>T</sub> + <i>I</i><sub>S</sub>) sigue forzada a ser cero. Para lograrlo, el sistema se "autoajusta" moviendo el potencial del punto N.</li>
            </ul>
            
            <h3>Consecuencias del Desequilibrio</h3>
            <p>Aparece una <strong>"tensiÃ³n de desplazamiento del neutro" (<i>V</i><sub>Nn</sub>)</strong>. Esto es catastrÃ³fico:</p>
            <ul>
                <li>Algunas cargas recibirÃ¡n <strong>SOBRETENSIÃ“N</strong> (ej. 235V) y se quemarÃ¡n.</li>
                <li>Otras cargas recibirÃ¡n <strong>SUBTENSIÃ“N</strong> (ej. 190V) y funcionarÃ¡n mal o no arrancarÃ¡n.</li>
            </ul>

            <div class="interactive-diagram">
                <h3>Diagrama Interactivo: Desplazamiento del Neutro</h3>
                
                <svg id="star-diagram" viewBox="-50 -50 400 400" width="400" height="400" style="margin: auto; display: block; border-radius: 8px;">
                    <circle cx="150" cy="150" r="4" fill="white" />
                    <text x="155" y="155" fill="white">n (0V)</text>
                    
                    <line x1="150" y1="150" x2="270" y2="150" stroke="#555" stroke-dasharray="4"/> <line x1="150" y1="150" x2="90" y2="46" stroke="#555" stroke-dasharray="4"/> <line x1="150" y1="150" x2="90" y2="254" stroke="#555" stroke-dasharray="4"/> <text x="275" y="155" fill="#f77272">R (0Â°)</text>
                    <text x="85" y="41" fill="#7aa2f7" text-anchor="end">T (120Â°)</text>
                    <text x="85" y="259" fill="#73daca" text-anchor="end">S (240Â°)</text>

                    <line id="line-R" x1="270" y1="150" x2="150" y2="150" stroke-width="3" stroke="var(--color-danger)" />
                    <line id="line-T" x1="90" y1="46" x2="150" y2="150" stroke-width="3" stroke="var(--color-accent)" />
                    <line id="line-S" x1="90" y1="254" x2="150" y2="150" stroke-width="3" stroke="var(--color-success)" />
                    
                    <text id="text-R" x="210" y="145" fill="#f77272">V_R</text>
                    <text id="text-T" x="120" y="93" fill="#7aa2f7">V_T</text>
                    <text id="text-S" x="120" y="207" fill="#73daca">V_S</text>

                    <circle id="neutral-point-N" cx="150" cy="150" r="6" fill="var(--color-warning)" stroke="white" stroke-width="2" />
                    <text x="160" y="140" fill="var(--color-warning)" id="text-N">N</text>
                </svg>

                <div class="controls">
                    <label>Neutro Conectado</label>
                    <label class="switch">
                        <input type="checkbox" id="balance-switch">
                        <span class="slider"></span>
                    </label>
                    <label>Neutro Flotante</label>
                </div>

                <div class="controls-grid">
                    <div class="load-control load-control-r">
                        <h4>Carga R</h4>
                        <div class="slider-group">
                            <label>|<i>Z</i><sub>R</sub>|: <span id="Zr-mag-val">10</span> Î©</label>
                            <input type="range" id="Zr-mag" min="1" max="100" value="10">
                        </div>
                        <div class="slider-group">
                            <label>Ï†<sub>R</sub>: <span id="Zr-ang-val">0</span> Â°</label>
                            <input type="range" id="Zr-ang" min="-90" max="90" value="0">
                        </div>
                    </div>
                    <div class="load-control load-control-t">
                        <h4>Carga T</h4>
                        <div class="slider-group">
                            <label>|<i>Z</i><sub>T</sub>|: <span id="Zt-mag-val">10</span> Î©</label>
                            <input type="range" id="Zt-mag" min="1" max="100" value="10">
                        </div>
                        <div class="slider-group">
                            <label>Ï†<sub>T</sub>: <span id="Zt-ang-val">0</span> Â°</label>
                            <input type="range" id="Zt-ang" min="-90" max="90" value="0">
                        </div>
                    </div>
                    <div class="load-control load-control-s">
                        <h4>Carga S</h4>
                        <div class="slider-group">
                            <label>|<i>Z</i><sub>S</sub>|: <span id="Zs-mag-val">10</span> Î©</label>
                            <input type="range" id="Zs-mag" min="1" max="100" value="10">
                        </div>
                        <div class="slider-group">
                            <label>Ï†<sub>S</sub>: <span id="Zs-ang-val">0</span> Â°</label>
                            <input type="range" id="Zs-ang" min="-90" max="90" value="0">
                        </div>
                    </div>
                </div>

                <div class="info-box" id="info-box-1">
                    <div>
                        <span>TensiÃ³n <i>V</i><sub>R</sub></span>
                        <strong id="voltage-R">220 V</strong>
                    </div>
                    <div>
                        <span>TensiÃ³n <i>V</i><sub>T</sub></span>
                        <strong id="voltage-T">220 V</strong>
                    </div>
                    <div>
                        <span>TensiÃ³n <i>V</i><sub>S</sub></span>
                        <strong id="voltage-S">220 V</strong>
                    </div>
                    <div>
                        <span>Desplazamiento <i>V</i><sub>Nn</sub></span>
                        <strong id="voltage-Nn">0 V</strong>
                    </div>
                </div>
            </div>
            
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const body = document.body;

            function setDarkMode(isDark) {
                if (isDark) {
                    body.classList.add('dark-mode');
                    darkModeToggle.textContent = 'â˜€ï¸';
                    localStorage.setItem('darkMode', 'enabled');
                } else {
                    body.classList.remove('dark-mode');
                    darkModeToggle.textContent = 'ðŸŒ™';
                    localStorage.setItem('darkMode', 'disabled');
                }
            }

            const currentMode = localStorage.getItem('darkMode');
            let prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (currentMode === 'enabled') {
                setDarkMode(true);
            } else if (currentMode === 'disabled') {
                setDarkMode(false);
            } else {
                setDarkMode(prefersDark);
            }

            darkModeToggle.addEventListener('click', () => {
                setDarkMode(!body.classList.contains('dark-mode'));
            });

            const V_FASE = 220;
            const Vrn = { r: V_FASE * Math.cos(0 * Math.PI / 180), i: V_FASE * Math.sin(0 * Math.PI / 180) };
            const Vtn = { r: V_FASE * Math.cos(120 * Math.PI / 180), i: V_FASE * Math.sin(120 * Math.PI / 180) };
            const Vsn = { r: V_FASE * Math.cos(240 * Math.PI / 180), i: V_FASE * Math.sin(240 * Math.PI / 180) };

            const balanceSwitch = document.getElementById('balance-switch');
            const neutralPointN = document.getElementById('neutral-point-N');
            const lineR = document.getElementById('line-R');
            const lineT = document.getElementById('line-T');
            const lineS = document.getElementById('line-S');
            const textR = document.getElementById('text-R');
            const textT = document.getElementById('text-T');
            const textS = document.getElementById('text-S');
            const textN = document.getElementById('text-N');
            
            const voltageR = document.getElementById('voltage-R');
            const voltageT = document.getElementById('voltage-T');
            const voltageS = document.getElementById('voltage-S');
            const voltageNn = document.getElementById('voltage-Nn');

            const ZrMag = document.getElementById('Zr-mag');
            const ZrAng = document.getElementById('Zr-ang');
            const ZtMag = document.getElementById('Zt-mag');
            const ZtAng = document.getElementById('Zt-ang');
            const ZsMag = document.getElementById('Zs-mag');
            const ZsAng = document.getElementById('Zs-ang');
            
            const ZrMagVal = document.getElementById('Zr-mag-val');
            const ZrAngVal = document.getElementById('Zr-ang-val');
            const ZtMagVal = document.getElementById('Zt-mag-val');
            const ZtAngVal = document.getElementById('Zt-ang-val');
            const ZsMagVal = document.getElementById('Zs-mag-val');
            const ZsAngVal = document.getElementById('Zs-ang-val');

            const polarToRect = (mag, angleDeg) => {
                const angleRad = angleDeg * Math.PI / 180;
                return { r: mag * Math.cos(angleRad), i: mag * Math.sin(angleRad) };
            };
            const cAdd = (a, b) => ({ r: a.r + b.r, i: a.i + b.i });
            const cSub = (a, b) => ({ r: a.r - b.r, i: a.i - b.i });
            const cMul = (a, b) => ({ r: a.r * b.r - a.i * b.i, i: a.r * b.i + a.i * b.r });
            const cDiv = (a, b) => {
                const den = b.r * b.r + b.i * b.i;
                if (den === 0) return { r: 0, i: 0 };
                return {
                    r: (a.r * b.r + a.i * b.i) / den,
                    i: (a.i * b.r - a.r * b.i) / den
                };
            };
            const cMag = (a) => Math.sqrt(a.r * a.r + a.i * a.i);
            const getAdmittance = (mag, angleDeg) => {
                if (mag === 0) return { r: 0, i: 0 };
                const Ymag = 1 / mag;
                const Yang = -angleDeg;
                return polarToRect(Ymag, Yang);
            };

            function updateStarDiagram() {
                const Zr_mag = parseFloat(ZrMag.value);
                const Zr_ang = parseFloat(ZrAng.value);
                const Zt_mag = parseFloat(ZtMag.value);
                const Zt_ang = parseFloat(ZtAng.value);
                const Zs_mag = parseFloat(ZsMag.value);
                const Zs_ang = parseFloat(ZsAng.value);
                
                ZrMagVal.textContent = Zr_mag;
                ZrAngVal.textContent = Zr_ang;
                ZtMagVal.textContent = Zt_mag;
                ZtAngVal.textContent = Zt_ang;
                ZsMagVal.textContent = Zs_mag;
                ZsAngVal.textContent = Zs_ang;

                const Yr = getAdmittance(Zr_mag, Zr_ang);
                const Yt = getAdmittance(Zt_mag, Zt_ang);
                const Ys = getAdmittance(Zs_mag, Zs_ang);

                let Vnn = { r: 0, i: 0 };
                const neutralFlotante = balanceSwitch.checked;

                if (neutralFlotante) {
                    const num = cAdd(cAdd(cMul(Vrn, Yr), cMul(Vtn, Yt)), cMul(Vsn, Ys));
                    const den = cAdd(cAdd(Yr, Yt), Ys);
                    Vnn = cDiv(num, den);
                }

                const VRN = cSub(Vrn, Vnn);
                const VTN = cSub(Vtn, Vnn);
                const VSN = cSub(Vsn, Vnn);

                const magVRN = cMag(VRN);
                const magVTN = cMag(VTN);
                const magVSN = cMag(VSN);
                const magVnn = cMag(Vnn);
                
                voltageR.textContent = `${magVRN.toFixed(1)} V`;
                voltageT.textContent = `${magVTN.toFixed(1)} V`;
                voltageS.textContent = `${magVSN.toFixed(1)} V`;
                voltageNn.textContent = `${magVnn.toFixed(1)} V`;
                
                const setVoltageColor = (elem, v) => {
                    if (v > V_FASE * 1.1) elem.style.color = 'var(--danger-color)';
                    else if (v < V_FASE * 0.9) elem.style.color = 'var(--color-warning)';
                    else elem.style.color = 'var(--color-success)';
                };
                setVoltageColor(voltageR, magVRN);
                setVoltageColor(voltageT, magVTN);
                setVoltageColor(voltageS, magVSN);
                voltageNn.style.color = magVnn > 5 ? 'var(--danger-color)' : 'var(--color-success)';

                const scale = 120 / V_FASE;
                const cx_N = 150 + Vnn.r * scale;
                const cy_N = 150 - Vnn.i * scale;

                neutralPointN.setAttribute('cx', cx_N);
                neutralPointN.setAttribute('cy', cy_N);
                
                lineR.setAttribute('x2', cx_N);
                lineR.setAttribute('y2', cy_N);
                lineT.setAttribute('x2', cx_N);
                lineT.setAttribute('y2', cy_N);
                lineS.setAttribute('x2', cx_N);
                lineS.setAttribute('y2', cy_N);
                
                textR.setAttribute('x', (270 + cx_N) / 2 + 5);
                textR.setAttribute('y', (150 + cy_N) / 2);
                textT.setAttribute('x', (90 + cx_N) / 2 - 5);
                textT.setAttribute('y', (46 + cy_N) / 2);
                textS.setAttribute('x', (90 + cx_N) / 2 - 5);
                textS.setAttribute('y', (254 + cy_N) / 2);
                textN.setAttribute('x', cx_N + 10);
                textN.setAttribute('y', cy_N - 10);
            }

            [balanceSwitch, ZrMag, ZrAng, ZtMag, ZtAng, ZsMag, ZsAng].forEach(el => {
                el.addEventListener('input', updateStarDiagram);
            });
            updateStarDiagram();
        });
    </script>
</body>
</html>