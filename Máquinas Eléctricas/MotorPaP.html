<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Avanzado de Motor PaP (v4)</title>
    
    <style>
        /* --- 1. TU C√ìDIGO CSS (PASTELES) --- */
        :root {
            /* Modo Claro (Verde Agua/Menta Pastel) */
            --bg-color: #f0fdf4;
            --card-bg: #ffffff;
            --text-color: #2e4a4a;
            --text-light: #6a9c9c;
            --border-color: #d2f0e0;
            --primary-color: #5ab17c;
            --primary-hover: #4a9e6b;
            --danger-color: #e76f51;
            --danger-hover: #d05c43;
            --code-bg: #e0f2f7;
            --shadow: 0 4px 12px rgba(0,0,0,0.05);
            --shadow-hover: 0 6px 16px rgba(0,0,0,0.1);
            
            /* --- Colores Personalizados del Motor --- */
            --motor-estator: #eceff1;
            --motor-estator-borde: var(--border-color);
            
            /* Colores del Rotor (coinciden con peligro/info) */
            --motor-rotor-norte: var(--danger-color); 
            --motor-rotor-sur: #3498db; /* Un azul claro */
            
            /* --- CAMBIO CLAVE: Colores de Polaridad Pastel --- */
            --motor-polo-norte: #f5b7b1; /* Rojo Pastel (lighten danger) */
            --motor-polo-sur: #a9cce3; /* Celeste Pastel (lighten sur) */
            --motor-bobina-off: #dfe6e9;
        }

        body.dark-mode {
            /* Modo Oscuro (Morado/Lavanda Pastel) */
            --bg-color: #1a1523;
            --card-bg: #28203d;
            --text-color: #e6e0f0;
            --text-light: #afa2c3;
            --border-color: #43386b;
            --primary-color: #a78bfa;
            --primary-hover: #9175d6;
            --danger-color: #ef778a;
            --danger-hover: #d56073;
            --code-bg: #3d305e;
            --shadow: 0 4px 12px rgba(0,0,0,0.2);
            --shadow-hover: 0 6px 16px rgba(0,0,0,0.3);

            /* --- Colores Motor (Oscuro) --- */
            --motor-estator: #3d305e;
            --motor-estator-borde: var(--border-color);
            --motor-bobina-off: #5b517d;

            /* --- CAMBIO CLAVE: Colores de Polaridad (Oscuro) --- */
            --motor-polo-norte: #d98880; /* Rojo Pastel (darken danger) */
            --motor-polo-sur: #74a4c4; /* Celeste Pastel (darken sur) */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        h1, h2, h3 { color: var(--primary-color); transition: color 0.3s ease; }
        h1 { text-align: center; }
        h2 { border-bottom: 2px solid var(--border-color); padding-bottom: 5px; }
        
        button {
            padding: 10px 15px;
            font-size: 16px;
            border-radius: 5px;
            border: none;
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease, color 0.3s ease;
        }
        button:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        button:disabled {
            background-color: var(--text-light);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        button.danger { background-color: var(--danger-color); }
        button.danger:hover { background-color: var(--danger-hover); }

        /* --- 3. Contenedores (Tarjetas) --- */
        .simulador-card, .controles, .estado-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .controles {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        #darkModeToggle {
            background-color: transparent;
            color: var(--text-color);
            font-size: 24px;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            padding: 0;
            margin-left: auto;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        #darkModeToggle:hover {
            background-color: var(--code-bg);
            transform: translateY(-2px) rotate(15deg);
        }

        /* --- 4. ESTILOS DEL SIMULADOR --- */

        .simulador-card {
            display: flex;
            justify-content: center;
            align-items: center;
            padding-top: 40px;
            padding-bottom: 40px;
            overflow: hidden;
        }
        
        #estator {
            position: relative;
            width: 320px;
            height: 320px;
            border: 10px solid var(--motor-estator-borde);
            border-radius: 50%;
            background-color: var(--motor-estator);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        #rotor {
            position: absolute;
            width: 200px;
            height: 40px;
            /* Rotor con colores Norte (Rojo) y Sur (Azul) */
            background: linear-gradient(90deg, var(--motor-rotor-norte) 48%, #333 48%, #333 52%, var(--motor-rotor-sur) 52%);
            border: 4px solid #333;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            top: 50%;
            left: 50%;
            margin-left: -100px;
            margin-top: -20px; 
            transition: transform 0.15s ease-in-out; 
            transform-origin: center;
            transform: rotate(0deg);
        }
        
        .bobina {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: var(--motor-bobina-off);
            border: 4px solid var(--motor-estator-borde);
            border-radius: 15px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            /* Transici√≥n r√°pida para el cambio de polaridad */
            transition: background-color 0.1s ease, border-color 0.3s ease, color 0.3s ease, transform 0.1s ease;
            top: 50%;
            left: 50%;
            margin: -30px;
        }
        
        /* --- CAMBIO CLAVE: Clases de Polaridad --- */
        .energizada-norte {
            background-color: var(--motor-polo-norte);
            border-color: var(--motor-rotor-norte);
            color: #333;
            transform: scale(1.05);
        }
        .energizada-sur {
            background-color: var(--motor-polo-sur);
            border-color: var(--motor-rotor-sur);
            color: #333;
            transform: scale(1.05);
        }
        
        /* Posicionamiento de las 6 bobinas */
        #bobina-a1 { transform: translate(140px); }
        #bobina-b1 { transform: rotate(60deg) translate(140px) rotate(-60deg); }
        #bobina-c1 { transform: rotate(120deg) translate(140px) rotate(-120deg); }
        #bobina-a2 { transform: translate(-140px); }
        #bobina-b2 { transform: rotate(240deg) translate(140px) rotate(-240deg); }
        #bobina-c2 { transform: rotate(300deg) translate(140px) rotate(-300deg); }
        
        /* Tarjeta de Estado */
        .estado-card {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--code-bg);
            color: var(--text-color);
            line-height: 1.8;
            font-size: 1.1em;
        }
        .estado-card strong {
            color: var(--primary-color);
            font-weight: 900;
        }
    </style>
</head>
<body>

    <h1>Simulador PaP (Bipolar / Medio Paso)</h1>

    <div class="simulador-card">
        <div id="estator">
            <div class="bobina" id="bobina-a1">A+</div>
            <div class="bobina" id="bobina-b1">B+</div>
            <div class="bobina" id="bobina-c1">C+</div>
            <div class="bobina" id="bobina-a2">A-</div>
            <div class="bobina" id="bobina-b2">B-</div>
            <div class="bobina" id="bobina-c2">C-</div>
            <div id="rotor"></div>
        </div>
    </div>

    <div class="controles">
        <button id="btn-paso-izq">Paso Izquierda</button>
        <button id="btn-paso-der">Paso Derecha</button>
        <button id="btn-girar-izq">Girar Izquierda</button>
        <button id="btn-girar-der">Girar Derecha</button>
        <button id="btn-detener" class="danger" disabled>Detener</button>
        <button id="darkModeToggle">üåô</button>
    </div>
    
    <div class="estado-card">
        <h2>Estado Actual</h2>
        <div>Pasos: <strong id="estado-paso">0 (Paso 0)</strong></div>
        <div>√Ångulo: <strong id="estado-angulo">0</strong>¬∞</div>
        <div>Fases Activas: <strong id="estado-fases">---</strong></div>
    </div>

    <script>
        // --- 1. CAPTURAR ELEMENTOS ---
        const rotor = document.getElementById('rotor');
        const modoOscuroBtn = document.getElementById('darkModeToggle');
        const estadoPaso = document.getElementById('estado-paso');
        const estadoAngulo = document.getElementById('estado-angulo');
        const estadoFases = document.getElementById('estado-fases');
        const btnPasoIzq = document.getElementById('btn-paso-izq');
        const btnPasoDer = document.getElementById('btn-paso-der');
        const btnGirarIzq = document.getElementById('btn-girar-izq');
        const btnGirarDer = document.getElementById('btn-girar-der');
        const btnDetener = document.getElementById('btn-detener');

        const bobinas = {
            a1: document.getElementById('bobina-a1'),
            b1: document.getElementById('bobina-b1'),
            c1: document.getElementById('bobina-c1'),
            a2: document.getElementById('bobina-a2'),
            b2: document.getElementById('bobina-b2'),
            c2: document.getElementById('bobina-c2')
        };
        const listaBobinas = Object.values(bobinas);
        const listaBotones = [btnPasoIzq, btnPasoDer, btnGirarIzq, btnGirarDer];

        // --- 2. ESTADO DEL MOTOR Y SECUENCIA ---
        
        // --- CAMBIO CLAVE: Secuencia de 12 pasos (Half-Step) ---
        const TOTAL_PASOS = 12;
        const ANGULO_POR_PASO = 30; // 360 / 12

        // Secuencia Bipolar de Medio Paso
        // 0 = OFF, 1 = NORTE (+), -1 = SUR (-)
        // El rotor (Norte/Rojo) ser√° ATRA√çDO por el SUR (Celeste).
        // Por lo tanto, el √°ngulo del rotor = √°ngulo de la bobina SUR.
        const secuenciaPasos = [
            // {a, b, c}
            { a: -1, b: 0,  c: 0  }, // Paso 0: A+ es SUR. Rotor a 0¬∞
            { a: -1, b: -1, c: 0  }, // Paso 1: A+ y B+ son SUR. Rotor a 30¬∞
            { a: 0,  b: -1, c: 0  }, // Paso 2: B+ es SUR. Rotor a 60¬∞
            { a: 0,  b: -1, c: -1 }, // Paso 3: B+ y C+ son SUR. Rotor a 90¬∞
            { a: 0,  b: 0,  c: -1 }, // Paso 4: C+ es SUR. Rotor a 120¬∞
            { a: 1,  b: 0,  c: -1 }, // Paso 5: C+ es SUR, A+ es NORTE. Rotor a 150¬∞
            { a: 1,  b: 0,  c: 0  }, // Paso 6: A+ es NORTE. Rotor a 180¬∞
            { a: 1,  b: 1,  c: 0  }, // Paso 7: A+ y B+ son NORTE. Rotor a 210¬∞
            { a: 0,  b: 1,  c: 0  }, // Paso 8: B+ es NORTE. Rotor a 240¬∞
            { a: 0,  b: 1,  c: 1  }, // Paso 9: B+ y C+ son NORTE. Rotor a 270¬∞
            { a: 0,  b: 0,  c: 1  }, // Paso 10: C+ es NORTE. Rotor a 300¬∞
            { a: -1, b: 0,  c: 1  }  // Paso 11: C+ es NORTE, A+ es SUR. Rotor a 330¬∞
        ];

        // La "memoria" del motor
        let pasoActual = 0; // √çndice del ciclo (0 a 11)
        let anguloFisico = 0; // √Ångulo acumulativo
        let pasosTotales = 0; // Contador de pasos acumulativo
        
        let intervaloGiro = null;
        const VELOCIDAD_GIRO = 200; // ms por paso (m√°s r√°pido)

        // --- 3. FUNCIONES DEL MOTOR ---

        /** Apaga todas las bobinas (quita ambas clases) */
        function apagarTodasLasBobinas() {
            listaBobinas.forEach(bobina => {
                bobina.classList.remove('energizada-norte');
                bobina.classList.remove('energizada-sur');
            });
        }

        /**
         * Funci√≥n Central: Actualiza el estado visual del motor
         * basado en las variables de estado.
         */
        function actualizarMotor() {
            // 1. Obtener la configuraci√≥n del paso actual
            const paso = secuenciaPasos[pasoActual];
            let fasesTexto = [];
            
            // 2. Girar el rotor al √°ngulo f√≠sico acumulado
            rotor.style.transform = `rotate(${anguloFisico}deg)`;
            
            // 3. Energizar/Desenergizar bobinas (L√≥gica Bipolar)
            apagarTodasLasBobinas();

            // Fase A
            if (paso.a === 1) { // A+ es NORTE, A- es SUR
                bobinas.a1.classList.add('energizada-norte');
                bobinas.a2.classList.add('energizada-sur');
                fasesTexto.push("A+ (N)");
            } else if (paso.a === -1) { // A+ es SUR, A- es NORTE
                bobinas.a1.classList.add('energizada-sur');
                bobinas.a2.classList.add('energizada-norte');
                fasesTexto.push("A- (N)");
            }
            
            // Fase B
            if (paso.b === 1) { // B+ es NORTE, B- es SUR
                bobinas.b1.classList.add('energizada-norte');
                bobinas.b2.classList.add('energizada-sur');
                fasesTexto.push("B+ (N)");
            } else if (paso.b === -1) { // B+ es SUR, B- es NORTE
                bobinas.b1.classList.add('energizada-sur');
                bobinas.b2.classList.add('energizada-norte');
                fasesTexto.push("B- (N)");
            }
            
            // Fase C
            if (paso.c === 1) { // C+ es NORTE, C- es SUR
                bobinas.c1.classList.add('energizada-norte');
                bobinas.c2.classList.add('energizada-sur');
                fasesTexto.push("C+ (N)");
            } else if (paso.c === -1) { // C+ es SUR, C- es NORTE
                bobinas.c1.classList.add('energizada-sur');
                bobinas.c2.classList.add('energizada-norte');
                fasesTexto.push("C- (N)");
            }
            
            // 4. Actualizar el texto de estado
            estadoPaso.textContent = `${pasosTotales} (Paso ${pasoActual})`;
            estadoAngulo.textContent = `${anguloFisico}¬∞`;
            estadoFases.textContent = fasesTexto.join(', ') || '---';
        }
        
        function pasoDerecha() {
            pasoActual = (pasoActual + 1) % TOTAL_PASOS;
            anguloFisico += ANGULO_POR_PASO;
            pasosTotales++;
            actualizarMotor();
        }
        
        function pasoIzquierda() {
            pasoActual = (pasoActual - 1 + TOTAL_PASOS) % TOTAL_PASOS;
            anguloFisico -= ANGULO_POR_PASO;
            pasosTotales--;
            actualizarMotor();
        }
        
        function toggleControles(girando) {
            listaBotones.forEach(btn => btn.disabled = girando);
            btnDetener.disabled = !girando;
        }
        
        function girarDerecha() {
            detenerGiro();
            toggleControles(true);
            intervaloGiro = setInterval(pasoDerecha, VELOCIDAD_GIRO);
        }

        function girarIzquierda() {
            detenerGiro();
            toggleControles(true);
            intervaloGiro = setInterval(pasoIzquierda, VELOCIDAD_GIRO);
        }
        
        function detenerGiro() {
            clearInterval(intervaloGiro);
            intervaloGiro = null;
            toggleControles(false);
        }

        // --- 4. L√ìGICA DEL MODO OSCURO ---
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const esModoOscuro = document.body.classList.contains('dark-mode');
            modoOscuroBtn.textContent = esModoOscuro ? '‚òÄÔ∏è' : 'üåô';
        }

        // --- 5. ASIGNAR EVENTOS (Event Listeners) ---
        btnPasoDer.addEventListener('click', pasoDerecha);
        btnPasoIzq.addEventListener('click', pasoIzquierda);
        btnGirarDer.addEventListener('click', girarDerecha);
        btnGirarIzq.addEventListener('click', girarIzquierda);
        btnDetener.addEventListener('click', detenerGiro);
        modoOscuroBtn.addEventListener('click', toggleDarkMode);

        // --- 6. INICIALIZACI√ìN ---
        actualizarMotor();

    </script>
</body>
</html>